import{Y as q,Z as B,x as k,A as C,a0 as F,c as a,a2 as s,at as M,a4 as P,au as $,a5 as A,ag as N,a7 as R,af as n,ac as d,V as E,a9 as l,ar as T,as as U,J as v,aa as _}from"./index-c1328633.js";import{c as j,e as D,u as I,d as J}from"./index.esm-d9a21ed6.js";import{V as L}from"./VContainer-dd25e81d.js";import{V as O}from"./VRow-131c1eee.js";import{V as m}from"./VCol-e88e5278.js";import{V as Y}from"./VForm-4cec9d94.js";const Z={style:{"white-space":"pre"}},z=n("h1",{class:"text-red text-h1"},"已下架",-1),te={__name:"ProductView",setup(G){const V=$(),p=A(),{api:y,apiAuth:h}=N(),i=q(),f=B(),t=k({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:""}),b=j({quantity:D().typeError("缺少數量").required("缺少數量").min(1,"數量最小為 1")}),{isSubmitting:g,handleSubmit:x}=I({validationSchema:b,initialValues:{quantity:1}}),c=J("quantity"),w=x(async u=>{var o,e;if(!f.isLogin){p.push("/login");return}try{const{data:r}=await h.patch("/users/cart",{product:t.value._id,quantity:u.quantity});f.cart=r.result,i({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(r){const S=((e=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";i({text:S,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return C(async()=>{var u,o;try{const{data:e}=await y.get("/products/"+V.params.id);t.value._id=e.result._id,t.value.name=e.result.name,t.value.price=e.result.price,t.value.description=e.result.description,t.value.image=e.result.image,t.value.sell=e.result.sell,t.value.category=e.result.category,document.title=`剪單 | ${t.value.name}`}catch(e){const r=((o=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";i({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),p.push("/")}}),(u,o)=>(R(),F(P,null,[a(L,null,{default:s(()=>[a(O,null,{default:s(()=>[a(m,{cols:"12"},{default:s(()=>[n("h1",null,d(t.value.name),1)]),_:1}),a(m,{cols:"12",md:"6"},{default:s(()=>[a(E,{src:t.value.image},null,8,["src"])]),_:1}),a(m,{cols:"12",md:"6"},{default:s(()=>[n("p",null,"$"+d(t.value.price),1),n("p",Z,d(t.value.description),1),a(Y,{disabled:l(g),onSubmit:T(l(w),["prevent"])},{default:s(()=>[a(U,{type:"number",min:"0",modelValue:l(c).value.value,"onUpdate:modelValue":o[0]||(o[0]=e=>l(c).value.value=e),modelModifiers:{number:!0},"error-messages":l(c).errorMessage.value},null,8,["modelValue","error-messages"]),a(v,{type:"submit","prepend-icon":"mdi-cart",loading:l(g)},{default:s(()=>[_("加入購物車")]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}),a(M,{class:"align-center justify-center text-center","model-value":!t.value.sell,persistent:""},{default:s(()=>[z,a(v,{to:"/",color:"green"},{default:s(()=>[_("回首頁")]),_:1})]),_:1},8,["model-value"])],64))}};export{te as default};
