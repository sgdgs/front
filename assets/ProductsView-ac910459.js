import{p as se,aH as ne,aI as Ve,g as re,D as ue,aJ as ie,aK as pe,o as O,u as ce,aL as de,aM as J,c as t,G as L,aN as xe,aO as be,x as v,s as ye,H as ke,A as he,z as E,B as we,aP as Ce,aQ as Pe,a4 as K,T as te,aR as Fe,aS as Be,aT as Se,aU as Ie,am as Q,aV as Ae,v as Me,y as Ue,Y as Re,a0 as Te,a2 as c,aW as De,aj as Ne,a6 as $e,a7 as le,J as G,aa as j,av as X,aX as He,V as _e,a1 as ze,a3 as Ee,a9 as d,au as Ge,ap as qe,aq as Oe,ac as Le,at as je,as as Ke,ab as Je,ai as We,W as Qe}from"./index-80d7f52a.js";import{c as Xe,a as Y,e as Ye,f as Ze,u as ea,d as q}from"./index.esm-1a07fb4a.js";import{V as aa}from"./VContainer-8ac70d2b.js";import{V as ta}from"./VRow-da8767c0.js";import{V as Z}from"./VCol-f52f2bcb.js";import{V as la}from"./VDivider-07b494a9.js";import{V as oa}from"./VDataTableServer-6d12f2c3.js";import{V as sa}from"./VForm-4830ea7e.js";import{m as na,a as oe,V as ra}from"./VSelect-083c81c9.js";import"./VDataTable-5da4998a.js";import"./VList-e21809c3.js";import"./VListItem-a6cca2a6.js";import"./VMenu-9cdfd628.js";const ua=se({...ne(),...Ve(na(),["inline"])},"VCheckbox"),ia=re()({name:"VCheckbox",inheritAttrs:!1,props:ua(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,B){let{attrs:p,slots:S}=B;const m=ue(e,"modelValue"),{isFocused:r,focus:h,blur:R}=ie(e),T=pe(),H=O(()=>e.id||`checkbox-${T}`);return ce(()=>{const[_,M]=de(p),D=J.filterProps(e),x=oe.filterProps(e);return t(J,L({class:["v-checkbox",e.class]},_,D,{modelValue:m.value,"onUpdate:modelValue":b=>m.value=b,id:H.value,focused:r.value,style:e.style}),{...S,default:b=>{let{id:y,messagesId:I,isDisabled:w,isReadonly:C}=b;return t(oe,L(x,{id:y.value,"aria-describedby":I.value,disabled:w.value,readonly:C.value},M,{modelValue:m.value,"onUpdate:modelValue":N=>m.value=N,onFocus:h,onBlur:R}),S)}})}),{}}});const ca=se({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...ne(),...xe()},"VTextarea"),da=re()({name:"VTextarea",directives:{Intersect:be},inheritAttrs:!1,props:ca(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,B){let{attrs:p,emit:S,slots:m}=B;const r=ue(e,"modelValue"),{isFocused:h,focus:R,blur:T}=ie(e),H=O(()=>typeof e.counterValue=="function"?e.counterValue(r.value):(r.value||"").toString().length),_=O(()=>{if(p.maxlength)return p.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function M(o,f){var u,g;!e.autofocus||!o||(g=(u=f[0].target)==null?void 0:u.focus)==null||g.call(u)}const D=v(),x=v(),b=ye(""),y=v(),I=O(()=>e.persistentPlaceholder||h.value||e.active);function w(){var o;y.value!==document.activeElement&&((o=y.value)==null||o.focus()),h.value||R()}function C(o){w(),S("click:control",o)}function N(o){S("mousedown:control",o)}function W(o){o.stopPropagation(),w(),Q(()=>{r.value="",Ae(e["onClick:clear"],o)})}function z(o){var u;const f=o.target;if(r.value=f.value,(u=e.modelModifiers)!=null&&u.trim){const g=[f.selectionStart,f.selectionEnd];Q(()=>{f.selectionStart=g[0],f.selectionEnd=g[1]})}}const k=v(),P=v(+e.rows),U=O(()=>["plain","underlined"].includes(e.variant));ke(()=>{e.autoGrow||(P.value=+e.rows)});function A(){e.autoGrow&&Q(()=>{if(!k.value||!x.value)return;const o=getComputedStyle(k.value),f=getComputedStyle(x.value.$el),u=parseFloat(o.getPropertyValue("--v-field-padding-top"))+parseFloat(o.getPropertyValue("--v-input-padding-top"))+parseFloat(o.getPropertyValue("--v-field-padding-bottom")),g=k.value.scrollHeight,$=parseFloat(o.lineHeight),n=Math.max(parseFloat(e.rows)*$+u,parseFloat(f.getPropertyValue("--v-input-control-height"))),l=parseFloat(e.maxRows)*$+u||1/0,i=Ue(g??0,n,l);P.value=Math.floor((i-u)/$),b.value=Me(i)})}he(A),E(r,A),E(()=>e.rows,A),E(()=>e.maxRows,A),E(()=>e.density,A);let V;return E(k,o=>{o?(V=new ResizeObserver(A),V.observe(k.value)):V==null||V.disconnect()}),we(()=>{V==null||V.disconnect()}),ce(()=>{const o=!!(m.counter||e.counter||e.counterValue),f=!!(o||m.details),[u,g]=de(p),{modelValue:$,...n}=J.filterProps(e),l=Ce(e);return t(J,L({ref:D,modelValue:r.value,"onUpdate:modelValue":i=>r.value=i,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":U.value},e.class],style:e.style},u,n,{centerAffix:P.value===1&&!U.value,focused:h.value}),{...m,default:i=>{let{id:a,isDisabled:s,isDirty:F,isReadonly:me,isValid:ve}=i;return t(Pe,L({ref:x,style:{"--v-textarea-control-height":b.value},onClick:C,onMousedown:N,"onClick:clear":W,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},l,{id:a.value,active:I.value||F.value,centerAffix:P.value===1&&!U.value,dirty:F.value||e.dirty,disabled:s.value,focused:h.value,error:ve.value===!1}),{...m,default:fe=>{let{props:{class:ee,...ae}}=fe;return t(K,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),te(t("textarea",L({ref:y,class:ee,value:r.value,onInput:z,autofocus:e.autofocus,readonly:me.value,disabled:s.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:w,onBlur:T},ae,g),null),[[Fe("intersect"),{handler:M},null,{once:!0}]]),e.autoGrow&&te(t("textarea",{class:[ee,"v-textarea__sizer"],id:`${ae.id}-sizer`,"onUpdate:modelValue":ge=>r.value=ge,ref:k,readonly:!0,"aria-hidden":"true"},null),[[Be,r.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:f?i=>{var a;return t(K,null,[(a=m.details)==null?void 0:a.call(m,i),o&&t(K,null,[t("span",null,null),t(Se,{active:e.persistentCounter||h.value,value:H.value,max:_.value},m.counter)])])}:void 0})}),Ie({},D,x,y)}}),ma=We("h1",{class:"text-center"},"商品管理",-1),Fa={__name:"ProductsView",setup(e){const{apiAuth:B}=Ne(),p=Re(),S=v(null),m=v(!1),r=v(""),h=n=>{n?(r.value=n._id,x.value.value=n.name,b.value.value=n.price,y.value.value=n.description,I.value.value=n.category,w.value.value=n.sell):r.value="",m.value=!0},R=()=>{m.value=!1,D(),S.value.deleteFileRecord()},T=["衣服","食品","3C","遊戲"],H=Xe({name:Y().required("缺少商品名稱"),price:Ye().typeError("商品價格格式錯誤").required("缺少商品價格").min(0,"商品價格不能小於 0"),description:Y().required("缺少商品說明"),category:Y().required("缺少商品分類").test("isCategory","商品分類錯誤",n=>T.includes(n)),sell:Ze()}),{handleSubmit:_,isSubmitting:M,resetForm:D}=ea({validationSchema:H,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),x=q("name"),b=q("price"),y=q("description"),I=q("category"),w=q("sell"),C=v([]),N=v([]),W=_(async n=>{var l,i,a;if(!((l=C.value[0])!=null&&l.error)&&!(r.value===""&&C.value.length===0))try{const s=new FormData;for(const F in n)s.append(F,n[F]);C.value.length>0&&s.append("image",C.value[0].file),r.value===""?await B.post("/products",s):await B.patch("/products/"+r.value,s),p({text:r.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),R(),g()}catch(s){console.log(s);const F=((a=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";p({text:F,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),z=v(10),k=v([{key:"createdAt",order:"desc"}]),P=v(1),U=v([]),A=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"說明",align:"center",sortable:!0,key:"description"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"},{title:"刪除",align:"center",sortable:!1,key:"delete"}],V=v(!0),o=v(0),f=v(""),u=async()=>{var n,l,i,a;V.value=!0;try{const{data:s}=await B.get("/products/all",{params:{page:P.value,itemsPerPage:z.value,sortBy:((n=k.value[0])==null?void 0:n.key)||"createdAt",sortOrder:((l=k.value[0])==null?void 0:l.order)==="asc"?1:-1,search:f.value}});U.value.splice(0,U.value.length,...s.result.data),o.value=s.result.total}catch(s){console.log(s);const F=((a=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";p({text:F,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}V.value=!1};u();const g=()=>{P.value=1,u()},$=async n=>{var l,i;try{await B.delete("/products/"+n),p({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),u()}catch(a){console.log(a);const s=((i=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:i.message)||"發生錯誤，請稍後再試";p({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(n,l)=>{const i=$e("VueFileAgent");return le(),Te(K,null,[t(aa,null,{default:c(()=>[t(ta,null,{default:c(()=>[t(Z,{cols:"12"},{default:c(()=>[ma]),_:1}),t(la),t(Z,{cols:"12"},{default:c(()=>[t(G,{color:"green",onClick:l[0]||(l[0]=a=>h())},{default:c(()=>[j("新增商品")]),_:1})]),_:1}),t(Z,{cols:"12"},{default:c(()=>[t(oa,{"items-per-page":z.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=a=>z.value=a),u],"sort-by":k.value,"onUpdate:sortBy":[l[3]||(l[3]=a=>k.value=a),u],page:P.value,"onUpdate:page":[l[4]||(l[4]=a=>P.value=a),u],items:U.value,headers:A,loading:V.value,"items-length":o.value,search:f.value,hover:""},{top:c(()=>[t(X,{label:"搜尋","append-icon":"mdi-magnify",modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=a=>f.value=a),"onClick:append":g,onKeydown:He(g,["enter"])},null,8,["modelValue"])]),"item.image":c(({item:a})=>[t(_e,{src:a.image,height:"50px"},null,8,["src"])]),"item.sell":c(({item:a})=>[a.sell?(le(),ze(Qe,{key:0,icon:"mdi-check"})):Ee("",!0)]),"item.edit":c(({item:a})=>[t(G,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:s=>h(a)},null,8,["onClick"])]),"item.delete":c(({item:a})=>[t(G,{icon:"mdi-delete",variant:"text",color:"red",onClick:s=>$(a._id)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(De,{modelValue:m.value,"onUpdate:modelValue":l[12]||(l[12]=a=>m.value=a),persistent:"",width:"500px"},{default:c(()=>[t(sa,{disabled:d(M),onSubmit:Ge(d(W),["prevent"])},{default:c(()=>[t(qe,null,{default:c(()=>[t(Oe,null,{default:c(()=>[j(Le(r.value===""?"新增商品":"編輯商品"),1)]),_:1}),t(je,null,{default:c(()=>[t(X,{label:"名稱",modelValue:d(x).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>d(x).value.value=a),"error-messages":d(x).errorMessage.value},null,8,["modelValue","error-messages"]),t(X,{label:"價格",type:"number",min:"0",modelValue:d(b).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>d(b).value.value=a),"error-messages":d(b).errorMessage.value},null,8,["modelValue","error-messages"]),t(ra,{label:"分類",items:T,modelValue:d(I).value.value,"onUpdate:modelValue":l[7]||(l[7]=a=>d(I).value.value=a),"error-messages":d(I).errorMessage.value},null,8,["modelValue","error-messages"]),t(ia,{label:"上架",modelValue:d(w).value.value,"onUpdate:modelValue":l[8]||(l[8]=a=>d(w).value.value=a),"error-messages":d(w).errorMessage.value},null,8,["modelValue","error-messages"]),t(da,{label:"說明",modelValue:d(y).value.value,"onUpdate:modelValue":l[9]||(l[9]=a=>d(y).value.value=a),"error-messages":d(y).errorMessage.value},null,8,["modelValue","error-messages"]),t(i,{modelValue:C.value,"onUpdate:modelValue":l[10]||(l[10]=a=>C.value=a),rawModelValue:N.value,"onUpdate:rawModelValue":l[11]||(l[11]=a=>N.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},"help-text":"選擇檔案或拖曳到這裡","max-files":1,"max-size":"1MB",ref_key:"fileAgent",ref:S},null,8,["modelValue","rawModelValue"])]),_:1}),t(Ke,null,{default:c(()=>[t(Je),t(G,{color:"red",disabled:d(M),onClick:R},{default:c(()=>[j("取消")]),_:1},8,["disabled"]),t(G,{color:"green",type:"submit",loading:d(M)},{default:c(()=>[j("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{Fa as default};
